<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚úàÔ∏è Tanit Airlines Registration</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #e0f7fa 0%, #b3e0ff 100%);
      color: #222;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .airline-header {
      background: linear-gradient(90deg, #0093e9 0%, #80d0c7 100%);
      color: #fff;
      padding: 0;
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0 0 38px 38px;
      box-shadow: 0 8px 32px rgba(0, 147, 233, 0.13);
      position: relative;
      transition: box-shadow 0.2s;
    }
    .airline-header img {
      height: 60px;
      width: 60px;
      margin-right: 22px;
      margin-left: 10px;
      transition: transform 0.2s;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      object-fit: cover;
      background: #fff;
      padding: 4px;
    }
    .airline-header h1 {
      display: inline-block;
      font-family: 'Baloo 2', 'Poppins', Arial, sans-serif;
      font-size: 2.7rem;
      font-weight: 700;
      letter-spacing: 2.5px;
      margin: 0;
      vertical-align: middle;
      text-shadow: 0 2px 8px #0093e955;
    }
    .airline-header:hover {
      box-shadow: 0 12px 40px rgba(0, 147, 233, 0.18);
    }
    .airline-header:hover img {
      transform: scale(1.08) rotate(-4deg);
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }
    .boarding-pass {
      background: #fff;
      max-width: 1100px;
      margin: 48px auto;
      padding: 0 0 36px 0;
      border-radius: 28px;
      box-shadow: 0 12px 48px rgba(0,147,233,0.13);
      border: 2.5px dashed #0093e9;
      position: relative;
      overflow: hidden;
    }
    .boarding-pass::before, .boarding-pass::after {
      content: '';
      position: absolute;
      width: 60px;
      height: 60px;
      background: #e0f7fa;
      border-radius: 50%;
      z-index: 1;
    }
    .boarding-pass::before {
      left: -30px;
      top: -30px;
    }
    .boarding-pass::after {
      right: -30px;
      bottom: -30px;
    }
    .section-card {
      background: #f8fbff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,147,233,0.06);
      padding: 24px 24px 12px 24px;
      margin: 32px 0 18px 0;
      position: relative;
    }
    .section-card h2 {
      display: flex;
      align-items: center;
      font-family: 'Baloo 2', 'Poppins', Arial, sans-serif;
      font-size: 1.3rem;
      color: #0093e9;
      margin: 0 0 18px 0;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .section-card h2 .icon {
      font-size: 1.5em;
      margin-right: 10px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: #1a3a5c;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 1.5px solid #b3e0ff;
      border-radius: 8px;
      font-size: 1em;
      background: #fafdff;
      transition: border 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      border: 1.5px solid #0093e9;
      outline: none;
    }
    textarea {
      resize: vertical;
    }
    .radio-group, .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 10px;
    }
    .radio-group label, .checkbox-group label {
      font-weight: normal;
    }
    .submit-btn {
      background: linear-gradient(90deg, #0093e9 0%, #80d0c7 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      margin-top: 30px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.2em;
      font-family: 'Baloo 2', 'Poppins', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: 1px;
      box-shadow: 0 4px 16px rgba(0,147,233,0.10);
      transition: background 0.2s, box-shadow 0.2s;
      display: block;
      width: 100%;
    }
    .submit-btn:hover {
      background: linear-gradient(90deg, #0077b6 0%, #0093e9 100%);
      box-shadow: 0 8px 32px rgba(0,147,233,0.13);
    }
    .airline-footer {
      text-align: center;
      color: #0077b6;
      font-size: 1.1em;
      margin: 32px 0 0 0;
      opacity: 0.7;
    }
    .form-steps {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      margin-top: 24px;
    }
    .form-col {
      flex: 1 1 350px;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .form-col.left {
      margin-right: 12px;
    }
    .form-col.right {
      margin-left: 12px;
    }
    .section-card {
      margin-bottom: 28px;
      border-left: 6px solid #0093e9;
      position: relative;
    }
    .section-card h2 {
      margin-bottom: 12px;
      font-size: 1.15rem;
      background: linear-gradient(90deg, #e0f7fa 60%, #b3e0ff 100%);
      border-radius: 8px;
      padding: 8px 16px;
      box-shadow: 0 2px 8px rgba(0,147,233,0.04);
      position: relative;
    }
    .section-card .step {
      display: inline-block;
      background: #0093e9;
      color: #fff;
      border-radius: 50%;
      width: 2em;
      height: 2em;
      text-align: center;
      line-height: 2em;
      font-size: 1.1em;
      font-family: 'Baloo 2', 'Poppins', Arial, sans-serif;
      margin-right: 10px;
      box-shadow: 0 2px 8px #b3e0ff44;
    }
    @media (max-width: 900px) {
      .form-steps {
        flex-direction: column;
        gap: 0;
      }
      .form-col.left, .form-col.right {
        margin: 0;
      }
    }
    @media (max-width: 600px) {
      .airline-header {
        min-height: 70px;
        padding: 10px 15px;
        border-radius: 0 0 25px 25px;
      }
      .airline-header img {
        height: 45px;
        width: 45px;
        margin-right: 15px;
        margin-left: 5px;
        border-width: 2px;
        padding: 3px;
      }
      .airline-header h1 {
        font-size: 1.8rem;
        letter-spacing: 1.5px;
        line-height: 1.2;
      }
      .boarding-pass {
        padding: 0 0 10px 0 !important;
      }
      .form-steps {
        flex-direction: column;
        gap: 0;
      }
      .form-col {
        margin: 0 !important;
      }
      .section-card {
        padding: 16px 8px 8px 8px;
      }
    }
    
    @media (max-width: 480px) {
      .airline-header {
        min-height: 60px;
        padding: 8px 12px;
        border-radius: 0 0 20px 20px;
      }
      .airline-header img {
        height: 38px;
        width: 38px;
        margin-right: 12px;
        margin-left: 3px;
        border-width: 2px;
        padding: 2px;
      }
      .airline-header h1 {
        font-size: 1.4rem;
        letter-spacing: 1px;
        line-height: 1.1;
      }
    }
    
    @media (max-width: 360px) {
      .airline-header {
        min-height: 55px;
        padding: 6px 10px;
      }
      .airline-header img {
        height: 32px;
        width: 32px;
        margin-right: 10px;
        margin-left: 2px;
        padding: 1px;
      }
      .airline-header h1 {
        font-size: 1.2rem;
        letter-spacing: 0.5px;
      }
    }
    /* Spinner pour le message d'envoi */
    .spinner {
      display: inline-block;
      width: 22px;
      height: 22px;
      border: 3px solid #b3e0ff;
      border-top: 3px solid #0093e9;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="airline-header">
    <img src="assets/img/logo tanit.png" alt="Tanit Airlines Logo" />
    <h1>Tanit Airlines ‚Äì Congress Registration</h1>
  </div>
  <div class="boarding-pass">
    <form name="submit-to-google-sheet" id="registration-form" style="padding: 0 30px;">
      <div class="form-steps">
        <div class="form-col left">
          <!-- Step 1: Personal Information -->
          <div class="section-card">
            <h2><span class="step">‚ë†</span> <span class="icon">üë§</span> Personal Information</h2>

            <label>Full Name *</label>
            <input type="text" name="Full Name" required>

            <label>Country *</label>
            <select name="Country" id="country-select" required>
              <option value="">Select your country</option>
              <option>Albania</option>
              <option>Algeria</option>
              <option>Argentina</option>
              <option>Armenia</option>
              <option>Australia</option>
              <option>Austria</option>
              <option>Azerbaijan</option>
              <option>Bahrain</option>
              <option>Bangladesh</option>
              <option>Belgium</option>
              <option>Benin</option>
              <option>Bolivia</option>
              <option>Bosnia and Herzegovina</option>
              <option>Brazil</option>
              <option>Bulgaria</option>
              <option>Burkina Faso</option>
              <option>Cambodia</option>
              <option>Cameroon</option>
              <option>Canada</option>
              <option>Chile</option>
              <option>China</option>
              <option>Colombia</option>
              <option>Costa Rica</option>
              <option>Croatia</option>
              <option>Czech Republic</option>
              <option>Denmark</option>
              <option>Dominican Republic</option>
              <option>Ecuador</option>
              <option>Egypt</option>
              <option>El Salvador</option>
              <option>Estonia</option>
              <option>Ethiopia</option>
              <option>Finland</option>
              <option>France</option>
              <option>Georgia</option>
              <option>Germany</option>
              <option>Ghana</option>
              <option>Greece</option>
              <option>Guatemala</option>
              <option>Hong Kong</option>
              <option>Hungary</option>
              <option>Iceland</option>
              <option>India</option>
              <option>Indonesia</option>
              <option>Italy</option>
              <option>Cote D'Ivoire</option>
              <option>Japan</option>
              <option>Jordan</option>
              <option>Kazakhstan</option>
              <option>Kenya</option>
              <option>Kuwait</option>
              <option>Kyrgyzstan</option>
              <option>Latvia</option>
              <option>Lebanon</option>
              <option>Liberia</option>
              <option>Lithuania</option>
              <option>Malaysia</option>
              <option>Mexico</option>
              <option>Moldova</option>
              <option>Mongolia</option>
              <option>Montenegro</option>
              <option>Morocco</option>
              <option>Mozambique</option>
              <option>Myanmar</option>
              <option>Nepal</option>
              <option>Netherlands</option>
              <option>New Zealand</option>
              <option>Nicaragua</option>
              <option>Nigeria</option>
              <option>North Macedonia</option>
              <option>Norway</option>
              <option>Pakistan</option>
              <option>Panama</option>
              <option>Paraguay</option>
              <option>Peru</option>
              <option>Philippines</option>
              <option>Poland</option>
              <option>Portugal</option>
              <option>Romania</option>
              <option>Russia</option>
              <option>Rwanda</option>
              <option>Senegal</option>
              <option>Serbia</option>
              <option>Singapore</option>
              <option>Slovakia</option>
              <option>South Africa</option>
              <option>South Korea</option>
              <option>Spain</option>
              <option>Sri Lanka</option>
              <option>Sweden</option>
              <option>Switzerland</option>
              <option>Taiwan</option>
              <option>Tanzania</option>
              <option>Thailand</option>
              <option>Togo</option>
              <option>Tunisia</option>
              <option>Turkey</option>
              <option>Uganda</option>
              <option>Ukraine</option>
              <option>United Arab Emirates</option>
              <option>United Kingdom</option>
              <option>United States</option>
              <option>Venezuela</option>
              <option>Vietnam</option>
            </select>

            <label>Entity Name *</label>
            <input type="text" name="Entity Name" required>

            <label>LC Name *</label>
            <input type="text" name="LC Name" required>

            <label>Passport Number *</label>
            <input type="text" name="Passport Number" required>

            <label>Email Address *</label>
            <input type="email" name="Email Address" required>

            <label>Phone Number *</label>
            <input type="tel" name="Phone Number" required>

            <label>Emergency Phone Number *</label>
            <input type="tel" name="Emergency Contact" required>

            <label>Gender *</label>
            <div class="radio-group" id="gender-group">
              <label><input type="radio" name="Gender" value="Male" required> Male</label>
              <label><input type="radio" name="Gender" value="Female"> Female</label>
              <label><input type="radio" name="Gender" value="Other"> Other</label>
            </div>
            <div class="other-input" id="gender-other" style="display:none; margin-top:8px;">
              <input type="text" name="Gender Other" placeholder="Please specify your gender..." />
            </div>

            <label>Date of Birth *</label>
            <input type="date" name="Date of Birth" required>
          </div>
          <!-- Step 2: Health & Dietary -->
          <div class="section-card">
            <h2><span class="step">‚ë°</span> <span class="icon">üçè</span> Health & Dietary</h2>

            <label>Do you have any allergies? *</label>
            <div class="radio-group">
              <label><input type="radio" name="Allergies" value="Yes" required> Yes</label>
              <label><input type="radio" name="Allergies" value="No"> No</label>
            </div>

            <label>Chronic medical conditions we should be aware of?</label>
            <div class="radio-group" id="chronic-group">
              <label><input type="radio" name="Chronic Condition" value="Yes"> Yes</label>
              <label><input type="radio" name="Chronic Condition" value="No"> No</label>
              <label><input type="radio" name="Chronic Condition" value="Other"> Other</label>
            </div>
            <div class="other-input" id="chronic-other" style="display:none; margin-top:8px;">
              <input type="text" name="Chronic Condition Other" placeholder="Please specify your condition..." />
            </div>

            <label>Dietary Restrictions *</label>
            <select name="Dietary" id="dietary-select" required>
              <option value="">Select</option>
              <option value="None">None</option>
              <option value="Vegetarian">Vegetarian</option>
              <option value="Vegan">Vegan</option>
              <option value="Halal">Halal</option>
              <option value="Kosher">Kosher</option>
              <option value="Gluten-Free">Gluten-Free</option>
              <option value="Other">Other</option>
            </select>
            <div class="other-input" id="dietary-other" style="display:none; margin-top:8px;">
              <input type="text" name="Dietary Other" placeholder="Please specify your dietary restriction..." />
            </div>
          </div>
        </div>
        <div class="form-col right">
          <!-- Step 3: Congress Expectations -->
          <div class="section-card">
            <h2><span class="step">‚ë¢</span> <span class="icon">üéØ</span> Congress Expectations</h2>

            <label>What are your main goals for attending the congress? *</label>
            <textarea name="Goals" required></textarea>

            <label>Which topics or sessions interest you most? *</label>
            <textarea name="Sessions" required></textarea>
          </div>
          <!-- Step 4: Collaboration & Support -->
          <div class="section-card">
            <h2><span class="step">‚ë£</span> <span class="icon">ü§ù</span> Collaboration & Support</h2>

            <label>How can our team support you during the event?</label>
            <textarea name="Support Needs"></textarea>

            <label>Preferred Communication Method *</label>
            <div class="radio-group" id="contact-group">
              <label><input type="radio" name="Contact Method" value="Email" required> Email</label>
              <label><input type="radio" name="Contact Method" value="WhatsApp"> WhatsApp</label>
              <label><input type="radio" name="Contact Method" value="Other"> Other</label>
            </div>
            <div class="other-input" id="contact-other" style="display:none; margin-top:8px;">
              <input type="text" name="Contact Method Other" placeholder="Please specify your contact method..." />
            </div>

            <label>Upload a photo of yourself</label>
            <input type="file" name="Photo" accept="image/*" max="50">
            <small style="color: #666; font-size: 0.9em;">Format: JPG, PNG, GIF (max 50MB)</small>

            <label>Favorite Football Team?</label>
            <input type="text" name="Football Team">

            <label>Favorite Hobby?</label>
            <input type="text" name="Hobby">

            <label>Places in Tunisia you want to visit?</label>
            <textarea name="Places to Visit"></textarea>

            <label>Any final comments or special requests?</label>
            <textarea name="Final Comments"></textarea>
          </div>
          <!-- Step 5: Congress Fees & Room -->
          <div class="section-card">
            <h2><span class="step">‚ë§</span> <span class="icon">üí≥</span> Congress Fees & Room</h2>

            <p id="fees-text">The participation fee is <strong>120 EUR/USD</strong>.</p>

            <label>Would you like to upgrade to a single room? *</label>
            <div class="radio-group" id="room-upgrade-group">
              <label><input type="radio" name="Room Upgrade" value="No" required> No (Shared accommodation)</label>
              <label id="room-upgrade-yes-label"><input type="radio" name="Room Upgrade" value="Yes"> Yes (+50 EUR/USD)</label>
            </div>
          </div>
          <!-- Step 6: Terms & Conditions -->
          <div class="section-card">
            <h2><span class="step">‚ë•</span> <span class="icon">üìÑ</span> Terms & Conditions</h2>
            <p>
              ‚Ä¢ I understand the total conference fee is 120 EUR/USD per night.<br>
              ‚Ä¢ I accept the 100% cancellation fee if I cancel.<br>
              ‚Ä¢ I agree to pay +50 EUR/USD per night if I choose a single room.<br>
              ‚Ä¢ I confirm my information is accurate and I will comply with the rules.<br>
              ‚Ä¢ No refunds for no-shows or late cancellations.
            </p>

            <div class="checkbox-group">
              <label><input type="checkbox" name="Agreement" value="I Agree" required> I fully agree to the terms and conditions outlined above.</label>
            </div>
          </div>
        </div>
      </div>
      <button class="submit-btn" type="submit"><span style='font-size:1.3em;'>‚úàÔ∏è</span> Submit Registration</button>
    </form>
  </div>
  <div class="airline-footer">
    &copy; Tanit Airlines 2025. All rights reserved.
  </div>

  <!-- Message de statut (succ√®s, en cours, erreur) -->
  <div id="form-status-message" style="
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    color: #222;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0,147,233,0.13);
    padding: 22px 36px;
    font-size: 1.15em;
    font-family: 'Poppins', Arial, sans-serif;
    z-index: 9999;
    min-width: 220px;
    text-align: center;
  "></div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxcxBGNUyh4qxmSgqdO2gXbDMPNRy0k2cOD4lkOytRLb2lFiizXcZSX7MFNBTRsOpWM/exec';
    const form = document.forms['submit-to-google-sheet'];

    // Affichage dynamique des champs 'Other'
    document.addEventListener('DOMContentLoaded', function() {
      // Gender
      document.querySelectorAll('input[name="Gender"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById('gender-other').style.display = (this.value === 'Other') ? 'block' : 'none';
        });
      });
      // Chronic Condition
      document.querySelectorAll('input[name="Chronic Condition"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById('chronic-other').style.display = (this.value === 'Other') ? 'block' : 'none';
        });
      });
      // Dietary
      document.getElementById('dietary-select').addEventListener('change', function() {
        document.getElementById('dietary-other').style.display = (this.value === 'Other') ? 'block' : 'none';
      });
      // Contact Method
      document.querySelectorAll('input[name="Contact Method"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById('contact-other').style.display = (this.value === 'Other') ? 'block' : 'none';
        });
      });
    });

    // Fonction pour convertir l'image en base64
    function convertImageToBase64(file) {
      return new Promise((resolve, reject) => {
        // V√©rifier la taille du fichier (50MB max)
        const maxSize = 50 * 1024 * 1024; // 50MB en bytes
        if (file.size > maxSize) {
          reject(new Error('Fichier trop volumineux. Taille max: 50MB'));
          return;
        }

        // V√©rifier le type de fichier
        if (!file.type.startsWith('image/')) {
          reject(new Error('Format de fichier non support√©. Utilisez JPG, PNG ou GIF'));
          return;
        }

        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Fonction pour obtenir la valeur s√©lectionn√©e des boutons radio
    function getSelectedRadioValue(name) {
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      return selected ? selected.value : '';
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const statusMsg = document.getElementById('form-status-message');
      const submitBtn = form.querySelector('.submit-btn');
      
      // Validation des champs requis AVANT de d√©sactiver les champs
      const requiredFields = [
        'Full Name', 'Country', 'Entity Name', 'LC Name', 'Passport Number',
        'Email Address', 'Phone Number', 'Emergency Contact', 'Date of Birth',
        'Allergies', 'Dietary', 'Goals', 'Sessions', 'Contact Method', 'Room Upgrade'
      ];

      for (const fieldName of requiredFields) {
        const field = form.querySelector(`[name="${fieldName}"]`);
        if (field && field.type === 'radio') {
          const selected = form.querySelector(`[name="${fieldName}"]:checked`);
          if (!selected) {
            alert(`‚ö†Ô∏è Veuillez s√©lectionner une option pour: ${fieldName}`);
            return;
          }
        } else if (field && field.type === 'select-one') {
          if (!field.value) {
            alert(`‚ö†Ô∏è Veuillez s√©lectionner une option pour: ${fieldName}`);
            return;
          }
        } else if (field && field.type === 'checkbox') {
          if (!field.checked) {
            alert(`‚ö†Ô∏è Veuillez accepter les termes et conditions`);
            return;
          }
        } else if (field && !field.value.trim()) {
          alert(`‚ö†Ô∏è Veuillez remplir le champ: ${fieldName}`);
          field.focus();
          return;
        }
      }

      // Validation sp√©cifique pour Gender
      const genderSelected = getSelectedRadioValue('Gender');
      if (!genderSelected) {
        alert('‚ö†Ô∏è Veuillez s√©lectionner votre genre');
        return;
      }

      // Cr√©er un nouveau FormData AVANT de d√©sactiver les champs
      const formData = new FormData(form);
      
      // G√©rer l'upload de photo
      const photoFile = formData.get('Photo');
      if (photoFile && photoFile.size > 0) {
        try {
          const base64Image = await convertImageToBase64(photoFile);
          formData.set('Photo', base64Image);
        } catch (error) {
          console.error('Erreur conversion photo:', error);
          alert(`‚ö†Ô∏è Erreur photo: ${error.message}`);
          return;
        }
      } else {
        formData.set('Photo', 'Aucune photo upload√©e');
      }

      // S'assurer que les valeurs des boutons radio sont bien captur√©es
      // GENDER
      const genderValue = getSelectedRadioValue('Gender');
      if (genderValue === 'Other') {
        const genderOther = form.querySelector('input[name="Gender Other"]');
        if (genderOther && genderOther.value.trim()) {
          formData.set('Gender', genderOther.value.trim());
        } else {
          formData.set('Gender', 'Other');
        }
      } else if (genderValue) {
        formData.set('Gender', genderValue);
      }

      // ALLERGIES
      const allergiesValue = getSelectedRadioValue('Allergies');
      if (allergiesValue) {
        formData.set('Allergies', allergiesValue);
      }

      // CHRONIC CONDITION
      const chronicValue = getSelectedRadioValue('Chronic Condition');
      if (chronicValue === 'Other') {
        const chronicOther = form.querySelector('input[name="Chronic Condition Other"]');
        if (chronicOther && chronicOther.value.trim()) {
          formData.set('Chronic Condition', chronicOther.value.trim());
        } else {
          formData.set('Chronic Condition', 'Other');
        }
      } else if (chronicValue) {
        formData.set('Chronic Condition', chronicValue);
      }

      // CONTACT METHOD
      const contactValue = getSelectedRadioValue('Contact Method');
      if (contactValue === 'Other') {
        const contactOther = form.querySelector('input[name="Contact Method Other"]');
        if (contactOther && contactOther.value.trim()) {
          formData.set('Contact Method', contactOther.value.trim());
        } else {
          formData.set('Contact Method', 'Other');
        }
      } else if (contactValue) {
        formData.set('Contact Method', contactValue);
      }

      // ROOM UPGRADE
      const roomValue = getSelectedRadioValue('Room Upgrade');
      if (roomValue) {
        formData.set('Room Upgrade', roomValue);
      }

      // MAINTENANT on peut d√©sactiver les champs et afficher le message de chargement
      statusMsg.innerHTML = '<span class="spinner"></span>Envoi en cours...';
      statusMsg.style.display = 'block';
      statusMsg.style.background = '#e0f7fa';
      statusMsg.style.color = '#0077b6';
      submitBtn.disabled = true;
      submitBtn.style.opacity = 0.6;
      // D√©sactiver tous les champs du formulaire
      Array.from(form.elements).forEach(el => { el.disabled = true; });
      
      try {
        // Debug: afficher les donn√©es qui vont √™tre envoy√©es
        console.log('Donn√©es √† envoyer:');
        for (let [key, value] of formData.entries()) {
          console.log(`${key}: ${value}`);
        }
        
        // Envoyer les donn√©es
        const response = await fetch(scriptURL, { 
          method: 'POST', 
          body: formData
        });
        
        console.log('R√©ponse du serveur:', response.status, response.statusText);
        
        if (response.ok) {
          // Afficher le message de succ√®s
          statusMsg.textContent = '‚úÖ Inscription envoy√©e avec succ√®s !';
          statusMsg.style.display = 'block';
          statusMsg.style.background = '#d4f8e8';
          statusMsg.style.color = '#1a7f4e';
          // Petite pause avant la redirection (pour que l'utilisateur voie le message)
          await new Promise(res => setTimeout(res, 900));
          // Extraire les donn√©es principales pour le boarding pass
          const name = formData.get('Full Name') || '';
          const country = formData.get('Country') || '';
          const dob = formData.get('Date of Birth') || '';
          const phone = formData.get('Phone Number') || '';
          const email = formData.get('Email Address') || '';
          const entity = formData.get('Entity Name') || '';
          const lcName = formData.get('LC Name') || '';
          const passport = formData.get('Passport Number') || '';
          const gender = formData.get('Gender') || '';
          const roomUpgrade = formData.get('Room Upgrade') || '';
          
          // G√©n√©rer un num√©ro de billet unique
          const ticketNumber = 'TN' + Date.now() + Math.random().toString(36).substr(2, 5).toUpperCase();
          
          // Redirection vers boarding pass avec les donn√©es
          const params = new URLSearchParams({
            name: name,
            country: country,
            dob: dob,
            phone: phone,
            email: email,
            entity: entity,
            lcName: lcName,
            passport: passport,
            gender: gender,
            roomUpgrade: roomUpgrade,
            ticketNumber: ticketNumber
          });
          
          window.location.href = `boardingpass.html?${params.toString()}`;
        } else {
          throw new Error('Erreur r√©seau');
        }
      } catch (error) {
        console.error('Erreur:', error);
        statusMsg.textContent = `‚ùå Erreur d'envoi. Merci de r√©essayer.`;
        statusMsg.style.display = 'block';
        statusMsg.style.background = '#ffeaea';
        statusMsg.style.color = '#b6002c';
        submitBtn.disabled = false;
        submitBtn.style.opacity = 1;
        // R√©activer tous les champs du formulaire
        Array.from(form.elements).forEach(el => { el.disabled = false; });
      }
    });

    // Dynamique fees selon le pays
    const countrySelect = document.getElementById('country-select');
    const feesText = document.getElementById('fees-text');
    const roomUpgradeYesLabel = document.getElementById('room-upgrade-yes-label');
    if (countrySelect && feesText && roomUpgradeYesLabel) {
      countrySelect.addEventListener('change', function() {
        if (this.value === 'Tunisia') {
          feesText.innerHTML = "The participation fee is <strong>120 dinars</strong>.";
          roomUpgradeYesLabel.innerHTML = '<input type="radio" name="Room Upgrade" value="Yes"> Yes (+50 dinars per night)';
        } else {
          feesText.innerHTML = "The participation fee is <strong>120 EUR/USD</strong>.";
          roomUpgradeYesLabel.innerHTML = '<input type="radio" name="Room Upgrade" value="Yes"> Yes (+50 EUR/USD per night)';
        }
      });
    }
  </script>
</body>
</html>
